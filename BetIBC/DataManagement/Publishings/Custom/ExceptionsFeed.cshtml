@using System.Web
[
@{
    int loopCount =  GetLoop("Rows").Count() - 1;
    var rows = GetLoop("Rows");
    int loopCounter = 0;
    var ViewId = Pageview.CurrentParagraph.ModuleProperties.get_Value("ViewID"); 

    //var rowsCounter = rows.Where(row => row.GetString("AccessUserAddress_Bookmaker") == "Skype Betting");
    //var rowsCounterToDisplay = rowsCounter.Count() -1 ;
}

@foreach (var row in rows)
{
    var name = row.GetString("ExceptionsList_Name");
    var valueRaw = row.GetString("ExceptionsList_Value");
    var isPercent = row.GetString("ExceptionsList_Is_Procent");
    var rowId = row.GetString("ExceptionsListID");
    var valueForLessThanMinRaw = row.GetString("ExceptionsList_Value_for_less_then_min");
    var valueforLessThanMinIsPercent = row.GetString("ExceptionsList_Is_Procent_Value_for_less_then_min");
    var value = isPercent == "True" ? valueRaw + "%" : valueRaw;
    var valueForLessThanMin = valueforLessThanMinIsPercent == "True" ? valueForLessThanMinRaw + "%" : valueForLessThanMinRaw;
    var notes = row.GetString("ExceptionsList_Notes");
    var rowName = "ExceptionsListID";
    var parameter = "FORM_ROW_ID=" + rowName + "%3d" + rowId + "&VIEW_ID=" + ViewId;
    var editUrl = "/Default.aspx?ID=" + "118467" + "&" + parameter;
    var applyFor = row.GetString("ExceptionsList_Apply_for");
	if(loopCounter == loopCount){

        <text>
            {
            "Id" : "@rowId",
            "Name" : "@name",
            "Value" :"@valueRaw",
            "IsPercent" :"@isPercent",
            "ValueGraphic" : "@value",
            "ValueMin" : "@valueForLessThanMinRaw", 
            "ValueMinIsPercent" : "@valueforLessThanMinIsPercent",
            "ValueMinGraphic" : "@valueForLessThanMin",
            "ApplyTo" : "@applyFor",
            "Notes" : "@HttpUtility.JavaScriptStringEncode(notes)",
            "EditUrl" : "@editUrl"
            }
        </text>
    }else{
        <text>
            {
            "Id" : "@rowId",
            "Name" : "@name",
            "Value" :"@valueRaw",
            "IsPercent" :"@isPercent",
            "ValueGraphic" : "@value",
            "ValueMin" : "@valueForLessThanMinRaw", 
            "ValueMinIsPercent" : "@valueforLessThanMinIsPercent",
            "ValueMinGraphic" : "@valueForLessThanMin",
            "ApplyTo" : "@applyFor",
            "Notes" : "@HttpUtility.JavaScriptStringEncode(notes)",
            "EditUrl" : "@editUrl"
            },
        </text>
    }

    loopCounter ++;
}


]